<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Scraper</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.6/htmx.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Google Maps Scraper</h1>
            <nav>
                <a href="/api/docs" target="_blank" rel="noopener noreferrer">API Documentation</a>
                <a href="/api/swagger" target="_blank" rel="noopener noreferrer">Interactive API</a>
                <a href="/apikeys">API Keys</a>
            </nav>
        </header>
        <main>
            <div class="sidebar">
                <div id="error-container" class="error-message"></div>
                <form 
                    hx-post="/scrape" 
                    hx-target="#job-table tbody" 
                    hx-swap="beforeend"
                    hx-indicator="#spinner"
                    hx-on::before-request="document.getElementById('error-container').innerHTML = ''"
                    hx-on::after-request="if(!event.detail.successful) document.getElementById('error-container').innerHTML = event.detail.xhr.responseText"
                >
                    
                    <fieldset>
                        <legend>Job Details</legend>
                        <div class="form-group">
                            <label for="name">Job Name:</label>
                            <input type="text" id="name" name="name" value="{{.Name}}">
                        </div>
                        <div class="form-group">
                            <label for="keywords">Keywords:</label>
                            <textarea id="keywords" name="keywords" rows="10">{{ .KeywordsString }}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="lang">Language:</label>
                            <input type="text" id="lang" name="lang" value="{{.Language}}">
                        </div>
                    </fieldset>
                    
                    <details class="expandable-section">
                        <summary>Location Settings</summary>
                        <fieldset>
                            <div class="form-group">
                                <label for="zoom">Zoom:</label>
                                <input type="number" id="zoom" name="zoom" value="{{.Zoom}}">
                                <small class="text-muted">Regular mode: 0-21 (zoom level), Nearby mode: 51+ (meters)</small>
                            </div>
                            <div class="form-group">
                                <label for="latitude">Latitude:</label>
                                <input type="number" step="0.000000000000001" id="latitude" name="latitude" value="{{.Lat}}">
                            </div>
                            <div class="form-group">
                                <label for="longitude">Longitude:</label>
                                <input type="number" step="0.000000000000001" id="longitude" name="longitude" value="{{.Lon}}">
                            </div>
                        </fieldset>
                    </details>
                    
                    <details class="expandable-section">
                        <summary>Advanced Options</summary>
                        <fieldset>
                            <div class="form-group">
                                <label>Search Mode:</label>
                                <div class="mode-selector">
                                    <label class="mode-option">
                                        <input type="radio" name="mode" value="regular" {{if not .FastMode}}{{if not .NearbyMode}}{{if not .HybridMode}}{{if not .BrowserAPIMode}}checked{{end}}{{end}}{{end}}{{end}}>
                                        <span>Regular Mode</span>
                                    </label>
                                    <label class="mode-option">
                                        <input type="radio" name="mode" value="fast" {{if .FastMode}}checked{{end}}>
                                        <span>Fast Mode (BETA)</span>
                                    </label>
                                    <label class="mode-option">
                                        <input type="radio" name="mode" value="nearby" {{if .NearbyMode}}checked{{end}}>
                                        <span>Nearby Mode</span>
                                    </label>
                                    <label class="mode-option">
                                        <input type="radio" name="mode" value="hybrid" {{if .HybridMode}}checked{{end}}>
                                        <span>Hybrid Mode</span>
                                    </label>
                                    <label class="mode-option">
                                        <input type="radio" name="mode" value="browserapi" {{if .BrowserAPIMode}}checked{{end}}>
                                        <span>Browser API Mode</span>
                                    </label>
                                </div>
                                <small class="text-muted">
                                    <strong>Regular:</strong> Standard search |
                                    <strong>Fast:</strong> HTTP-based (no browser) |
                                    <strong>Nearby:</strong> Proximity search (requires lat/lon, zoom 51m+) |
                                    <strong>Hybrid:</strong> Fast + Nearby (requires lat/lon) |
                                    <strong>Browser API:</strong> Browser-based API scraping
                                </small>
                            </div>
                            <div class="form-group">
                                    <label for="radius">Radius:</label>
                                    <input type="number" id="radius" name="radius" value="{{.Radius}}">
                                    <small class="text-muted">Filter radius in meters (default: 10000)</small>
                            </div>
                            <div class="form-group">
                                <label for="depth">Depth:</label>
                                <input type="number" step="1" id="depth" name="depth" value="{{.Depth}}">
                            </div>
                            <div class="form-group">
                                <label for="concurrency">Concurrency:</label>
                                <input type="number" step="1" id="concurrency" name="concurrency" value="{{.Concurrency}}" min="1">
                                <small class="text-muted">Number of parallel browser workers (default: auto-detected)</small>
                            </div>
                            <div class="form-group checkbox">
                                <input type="checkbox" id="email" name="email" {{if .Email}}checked{{end}}>
                                <label for="email">Fetch Emails</label>
                            </div>
                            <div class="form-group">
                                <label for="maxtime">Max job time:</label>
                                <input type="text" id="maxtime" name="maxtime" value="{{.MaxTime}}">
                                <small class="text-muted">e.g., 10m, 30m, 1h</small>
                            </div>
                            <div class="form-group">
                                <label for="exitoninactivity">Exit on inactivity:</label>
                                <input type="text" id="exitoninactivity" name="exitoninactivity" value="{{.ExitOnInactivity}}">
                                <small class="text-muted">Exit after no activity (e.g., 5m, 10m, 15m). Leave empty to use Max job time.</small>
                            </div>
                        </fieldset>
                    </details>
                    <details class="expandable-section">
                        <summary>Proxies</summary>
                        <fieldset>
                            <div class="form-group">
                                <label for="proxies">Proxies:(one per line)</label>
                                <p class="text-muted"><small>Examples:<br>
                                        <p>HTTPS proxy with username/password: https://username:password@myproxy.local:443<p>
                                        <p>HTTP proxy with username/password: http://username:password@myproxy.local:443<p>
                                        <p>SOCKS5 proxy without auth: socks5://127.0.0.1:8000</p>
                                </p>

                                <textarea id="proxies" name="proxies" rows="5">{{.ProxiesString}}</textarea>
                            </div>
                        </fieldset>
                    </details>
                    
                    <button type="submit">Start Scraping</button>
                </form>

                <div class="import-section">
                    <h2>Import Data</h2>
                    <div id="import-error-container" class="error-message"></div>
                    <form
                        hx-post="/import"
                        hx-target="#job-table tbody"
                        hx-swap="beforeend"
                        hx-indicator="#import-spinner"
                        hx-encoding="multipart/form-data"
                        hx-on::before-request="document.getElementById('import-error-container').innerHTML = ''"
                        hx-on::after-request="if(event.detail.successful) { this.reset(); } else { document.getElementById('import-error-container').innerHTML = event.detail.xhr.responseText }"
                    >
                        <fieldset>
                            <legend>Import CSV or JSON</legend>
                            <div class="form-group">
                                <label for="import_job_name">Job Name (optional):</label>
                                <input type="text" id="import_job_name" name="import_job_name" placeholder="Auto-generated if empty">
                                <small class="text-muted">Leave empty to auto-generate from current date/time</small>
                            </div>
                            <div class="form-group">
                                <label for="import_file">Select File:</label>
                                <input type="file" id="import_file" name="import_file" accept=".csv,.json" required>
                                <small class="text-muted">
                                    Upload CSV or JSON files exported from normal, hybrid, nearby, or browserapi modes.<br>
                                    Files must contain: <strong>place_id</strong>, <strong>place_id_url</strong>, or <strong>link</strong>
                                </small>
                            </div>
                        </fieldset>
                        <button type="submit">Import Data</button>
                        <div id="import-spinner" class="spinner"></div>
                    </form>
                </div>
            </div>
            <div class="content">
                <div id="spinner" class="spinner"></div>
                <table id="job-table">
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Job Name</th>
                            <th>Job Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody hx-get="/jobs" hx-trigger="load, every 10s">
                        <!-- Job rows will be inserted here by HTMX -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</body>
</html>
